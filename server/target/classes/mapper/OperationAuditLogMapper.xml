<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.safetyfire.monitor.mapper.OperationAuditLogMapper">

    <resultMap id="OperationAuditLogMap" type="com.safetyfire.monitor.domain.entity.OperationAuditLogEntity">
        <id column="id" property="id"/>
        <result column="request_id" property="requestId"/>
        <result column="username" property="username"/>
        <result column="uri" property="uri"/>
        <result column="method" property="method"/>
        <result column="ip" property="ip"/>
        <result column="action" property="action"/>
        <result column="request_json" property="requestJson"/>
        <result column="response_code" property="responseCode"/>
        <result column="cost_ms" property="costMs"/>
    </resultMap>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO operation_audit_log (request_id, username, uri, method, ip, action, request_json, response_code, cost_ms, created_at, updated_at)
        VALUES (#{requestId}, #{username}, #{uri}, #{method}, #{ip}, #{action}, #{requestJson}, #{responseCode}, #{costMs}, NOW(3), NOW(3))
    </insert>

    <select id="list" resultMap="OperationAuditLogMap">
        SELECT id, request_id, username, uri, method, ip, action, request_json, response_code, cost_ms
        FROM operation_audit_log
        ORDER BY id DESC
        LIMIT #{pageSize} OFFSET #{offset}
    </select>

    <select id="count" resultType="long">
        SELECT COUNT(1) FROM operation_audit_log
    </select>

</mapper>

