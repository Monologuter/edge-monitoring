server:
  port: 9000

spring:
  application:
    name: monitor-server
  threads:
    virtual:
      enabled: true
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: ${MYSQL_URL:jdbc:mysql://47.120.48.64:3306/safetyfire?useUnicode=true&characterEncoding=UTF-8&allowPublicKeyRetrieval=true&verifyServerCertificate=false&useSSL=false&serverTimezone=Asia/Shanghai}
    username: ${MYSQL_USERNAME:root}
    password: ${MYSQL_PASSWORD:12345678}
  data:
    redis:
      host: ${REDIS_HOST:47.120.48.64}
      port: ${REDIS_PORT:6379}
  flyway:
    enabled: true
    # 建议：使用"干净数据库"直接跑迁移；避免对已有库自动 baseline 引发迁移冲突
    baseline-on-migrate: true
    baseline-version: 0
    validate-on-migrate: false

mybatis:
  mapper-locations: classpath*:mapper/*.xml
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus

app:
  jwt:
    # 注意：生产务必使用更长、更随机的密钥，并通过环境变量注入
    secret: "change_me_to_a_long_random_secret_key_32_chars_min!"
    access-ttl-seconds: 900
    refresh-ttl-seconds: 604800
  file:
    storage-type: LOCAL
    local-dir: "./.data/uploads"
  provincial:
    enabled: false
    base-url: "http://localhost:9999"
    warning-page-path: "/fws/rec/ew/com-page"
    feedback-path: "/fws/rec/ew/feedback"
  mqtt:
    # 统一协议后禁用 MQTT
    enabled: false
    broker-url: "tcp://47.120.48.64:1883"
    username: "admin"
    password: "admin"
    client-id-prefix: "safetyfire-server"
    ingest:
      # 统一协议后禁用 MQTT 接入
      enabled: false
      topic-prefix: "safetyfire/ingest"
      qos: 1
      client-id-prefix: "safetyfire-ingest"
  device-reading:
    scale:
      # 温度换算：原始值 / 10（例如 63 -> 6.3℃）
      temperature-divisor: 10
      # 湿度换算：原始值 / 10（例如 462 -> 46.2%）
      humidity-divisor: 10
      # 液位换算：原始值 / 1000（单位：m）
      level-divisor: 1000
  ip-speaker:
    # IP 音柱 HTTP 接口
    enabled: true
    api-url: "http://192.168.1.192/v1/api"
    volume: 80
    play-count: 1
    play-interval: 1
    queue: false
    sync-response: false
    tts-pitch: 50
    tts-speed: 50
    tts-voice-name: "xiaoyan"
    connect-timeout-ms: 2000
    read-timeout-ms: 4000
  linkage:
    tts:
      # 告警语音播报配置
      enabled: true
      default-prefix: "请注意，"
      mapping:
        - key: "非法入侵报警"
          text: "非法入侵报警"
        - key: "超员报警"
          text: "超员报警"
        - key: "通道堵塞报警"
          text: "通道堵塞报警"
        - key: "超高超重报警"
          text: "超高超重报警"
        - key: "摄像头遮挡偏移报警"
          text: "摄像头遮挡偏移报警"
        - key: "温湿度液位超高超低报警"
          text: "温湿度液位超高超低报警"
        - key: "证书过期报警"
          text: "证书过期报警"
  external:
    # 人员定位系统地址
    person-location-url: "http://192.168.1.20"
  auth:
    # 登录验证码
    captcha-enabled: false
    captcha-length: 4
    captcha-ttl-seconds: 120
  server-heartbeat:
    # 服务器在线判定阈值（毫秒）
    online-threshold-ms: 120000

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html

logging:
  level:
    root: INFO
    com.safetyfire.monitor: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] requestId=%X{requestId} %logger{36} - %msg%n"
