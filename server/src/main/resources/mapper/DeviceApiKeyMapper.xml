<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.safetyfire.monitor.mapper.DeviceApiKeyMapper">

    <resultMap id="DeviceApiKeyMap" type="com.safetyfire.monitor.domain.entity.DeviceApiKeyEntity">
        <id column="id" property="id"/>
        <result column="api_key" property="apiKey"/>
        <result column="api_secret" property="apiSecret"/>
        <result column="enabled" property="enabled"/>
        <result column="allowed_ips" property="allowedIps"/>
        <result column="rate_limit_per_minute" property="rateLimitPerMinute"/>
    </resultMap>

    <select id="findByApiKey" resultMap="DeviceApiKeyMap">
        SELECT id, api_key, api_secret, enabled, allowed_ips, rate_limit_per_minute
        FROM device_api_key
        WHERE api_key = #{apiKey}
        LIMIT 1
    </select>

    <select id="findAll" resultMap="DeviceApiKeyMap">
        SELECT id, api_key, api_secret, enabled, allowed_ips, rate_limit_per_minute
        FROM device_api_key
        ORDER BY id DESC
    </select>

    <select id="findById" resultMap="DeviceApiKeyMap">
        SELECT id, api_key, api_secret, enabled, allowed_ips, rate_limit_per_minute
        FROM device_api_key
        WHERE id = #{id}
        LIMIT 1
    </select>

    <insert id="insert">
        INSERT INTO device_api_key (api_key, api_secret, enabled, allowed_ips, rate_limit_per_minute)
        VALUES (#{apiKey}, #{apiSecret}, #{enabled}, #{allowedIps}, #{rateLimitPerMinute})
    </insert>

    <update id="update">
        UPDATE device_api_key
        SET api_secret = #{apiSecret},
            enabled = #{enabled},
            allowed_ips = #{allowedIps},
            rate_limit_per_minute = #{rateLimitPerMinute}
        WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM device_api_key WHERE id = #{id}
    </delete>

</mapper>
